<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Workout Logger</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 30px auto;
      background: #f7f7f7;
      padding: 20px;
      border-radius: 10px;
    }
    h1, h2 {
      text-align: center;
    }
    select, input, button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 8px;
      font-size: 16px;
    }
    .user-toggle {
      display: flex;
      justify-content: space-around;
    }
    .user-toggle button {
      width: 45%;
      padding: 10px;
    }
    .hidden {
      display: none;
    }
    #timer {
      font-size: 2em;
      text-align: center;
      margin: 20px 0;
    }
    .log, .history {
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      margin-top: 20px;
    }
    .tabs {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    .tabs button {
      width: 48%;
      padding: 12px;
      font-size: 16px;
    }
    .history-date {
      font-weight: bold;
      margin-top: 10px;
      padding: 5px;
      background-color: #eee;
      border-radius: 5px;
    }
    #maxWeightDisplay {
      font-weight: bold;
      text-align: center;
      margin: 10px 0;
    }
  </style>
</head>
<body>

<h1>Workout Logger</h1>

<div class="tabs">
  <button onclick="showTab('workoutTab')">üèãÔ∏è Workout</button>
  <button onclick="showTab('historyTab')">üìÖ History</button>
</div>

<!-- Workout Tab -->
<div id="workoutTab">
  <h2>1. Select or Add Exercise</h2>
  <select id="exerciseSelect" onchange="handleExerciseChange(this.value)">
    <option value="">-- Select Exercise --</option>
  </select>
  <input type="text" id="newExercise" placeholder="New exercise name">
  <button onclick="addExercise()">Add Exercise</button>

  <div id="maxWeightDisplay"></div>

  <h2>2. Who's Doing the Set?</h2>
  <div class="user-toggle">
    <button onclick="selectUser('Selim')">Selim</button>
    <button onclick="selectUser('Friend')">Friend</button>
  </div>

  <div id="setForm" class="hidden">
    <h2>3. Log Set (<span id="setCountDisplay">Set 1</span>)</h2>
    <label>Weight (kg):</label>
    <input type="number" id="weightInput">
    <label>Reps:</label>
    <input type="number" id="repsInput">
    <label>How hard? (RPE 1-10)</label>
    <input type="number" id="rpeInput" min="1" max="10">
    <button onclick="submitSet()">Submit Set</button>
  </div>

  <div id="restForm" class="hidden">
    <h2>4. Rest Time (seconds)</h2>
    <input type="number" id="restInput" placeholder="e.g. 60">
    <button onclick="startRest()">Start Rest</button>
    <div id="timer"></div>
  </div>

  <div class="hidden" id="nextSetPrompt">
    <h2>Next Set</h2>
    <button onclick="startNextSet()">Continue</button>
    <button onclick="endExercise()">Finish Exercise</button>
  </div>

  <div class="log" id="logOutput">
    <h3>Workout Log:</h3>
    <ul id="logList"></ul>
  </div>
</div>

<!-- History Tab -->
<div id="historyTab" class="hidden">
  <div class="history">
    <h2>Workout History</h2>
    <div id="historyOutput"></div>
  </div>
</div>

<script>
  let exercises = JSON.parse(localStorage.getItem("exercises")) || [];
  let workoutLog = JSON.parse(localStorage.getItem("workoutLog")) || [];

  let currentExercise = '';
  let currentUser = '';
  let setCounts = { Selim: 1, Friend: 1 };

  function getToday() {
    return new Date().toISOString().split("T")[0];
  }

  // Reset set counts daily (but keep logs)
  const today = getToday();
  const lastDate = localStorage.getItem("lastWorkoutDate");
  if (lastDate !== today) {
    localStorage.setItem("lastWorkoutDate", today);
    setCounts = { Selim: 1, Friend: 1 };
    localStorage.setItem("setCounts", JSON.stringify(setCounts));
  } else {
    const savedCounts = JSON.parse(localStorage.getItem("setCounts"));
    if (savedCounts) setCounts = savedCounts;
  }

  function updateSetCountDisplay() {
    document.getElementById('setCountDisplay').textContent = `Set ${setCounts[currentUser]}`;
  }

  function addExercise() {
    const name = document.getElementById('newExercise').value.trim();
    if (name && !exercises.includes(name)) {
      exercises.push(name);
      localStorage.setItem("exercises", JSON.stringify(exercises));
      const option = document.createElement('option');
      option.value = name;
      option.text = name;
      document.getElementById('exerciseSelect').appendChild(option);
      document.getElementById('exerciseSelect').value = name;
      handleExerciseChange(name);
      document.getElementById('newExercise').value = '';
    }
  }

  function handleExerciseChange(selected) {
    currentExercise = selected;
    updateMaxWeightDisplay(selected);
  }

  function updateMaxWeightDisplay(exerciseName) {
    if (!exerciseName) {
      document.getElementById('maxWeightDisplay').textContent = '';
      return;
    }

    let selimMax = 0;
    let friendMax = 0;

    for (let entry of workoutLog) {
      if (entry.exercise === exerciseName) {
        const weight = parseFloat(entry.weight);
        if (entry.user === 'Selim' && weight > selimMax) selimMax = weight;
        if (entry.user === 'Friend' && weight > friendMax) friendMax = weight;
      }
    }

    document.getElementById('maxWeightDisplay').textContent =
      `Max Weight - Selim: ${selimMax}kg | Friend: ${friendMax}kg`;
  }

  function selectUser(name) {
    if (!currentExercise) {
      alert("Please select an exercise first.");
      return;
    }
    currentUser = name;
    updateSetCountDisplay();
    document.getElementById('setForm').classList.remove('hidden');
  }

  function submitSet() {
    const weight = document.getElementById('weightInput').value;
    const reps = document.getElementById('repsInput').value;
    const rpe = document.getElementById('rpeInput').value;
    if (!weight || !reps || !rpe) {
      alert("Please fill in all set fields.");
      return;
    }

    const setNumber = setCounts[currentUser];
    const date = getToday();

    const entry = {
      user: currentUser,
      exercise: currentExercise,
      set: setNumber,
      weight,
      reps,
      rpe,
      date
    };

    workoutLog.push(entry);
    localStorage.setItem("workoutLog", JSON.stringify(workoutLog));
    localStorage.setItem("setCounts", JSON.stringify(setCounts));
    renderLogItem(entry);
    updateMaxWeightDisplay(currentExercise);

    setCounts[currentUser]++;
    document.getElementById('setForm').classList.add('hidden');
    document.getElementById('restForm').classList.remove('hidden');
  }

  function startRest() {
    const seconds = parseInt(document.getElementById('restInput').value);
    if (isNaN(seconds) || seconds <= 0) {
      alert("Enter a valid rest time.");
      return;
    }

    let time = seconds;
    const timer = document.getElementById('timer');
    timer.textContent = time + "s";
    document.getElementById('restInput').disabled = true;

    const interval = setInterval(() => {
      time--;
      timer.textContent = time + "s";
      if (time <= 0) {
        clearInterval(interval);
        document.getElementById('restForm').classList.add('hidden');
        document.getElementById('restInput').disabled = false;
        document.getElementById('timer').textContent = "";
        document.getElementById('nextSetPrompt').classList.remove('hidden');
      }
    }, 1000);
  }

  function startNextSet() {
    document.getElementById('weightInput').value = '';
    document.getElementById('repsInput').value = '';
    document.getElementById('rpeInput').value = '';
    document.getElementById('restInput').value = '';
    document.getElementById('nextSetPrompt').classList.add('hidden');
    updateSetCountDisplay();
    document.getElementById('setForm').classList.remove('hidden');
  }

  function endExercise() {
    alert("Exercise complete!");
    document.getElementById('nextSetPrompt').classList.add('hidden');
    document.getElementById('setForm').classList.add('hidden');
    document.getElementById('restForm').classList.add('hidden');
    currentExercise = '';
    currentUser = '';
    document.getElementById('exerciseSelect').value = '';
    document.getElementById('maxWeightDisplay').textContent = '';
  }

  function renderLogItem(entry) {
    const li = document.createElement('li');
    li.textContent = `${entry.user} - ${entry.exercise} Set ${entry.set}: ${entry.weight}kg x ${entry.reps} reps (RPE: ${entry.rpe})`;
    document.getElementById('logList').appendChild(li);
  }

  function renderHistory() {
    const historyOutput = document.getElementById('historyOutput');
    historyOutput.innerHTML = '';

    const grouped = {};
    for (let entry of workoutLog) {
      if (!grouped[entry.date]) grouped[entry.date] = [];
      grouped[entry.date].push(entry);
    }

    const sortedDates = Object.keys(grouped).sort((a, b) => b.localeCompare(a));
    for (let date of sortedDates) {
      const div = document.createElement('div');
      const dateTitle = document.createElement('div');
      dateTitle.textContent = date;
      dateTitle.className = 'history-date';
      div.appendChild(dateTitle);

      const ul = document.createElement('ul');
      for (let entry of grouped[date]) {
        const li = document.createElement('li');
        li.textContent = `${entry.user} - ${entry.exercise} Set ${entry.set}: ${entry.weight}kg x ${entry.reps} (RPE: ${entry.rpe})`;
        ul.appendChild(li);
      }
      div.appendChild(ul);
      historyOutput.appendChild(div);
    }
  }

  function showTab(tabId) {
    document.getElementById('workoutTab').classList.add('hidden');
    document.getElementById('historyTab').classList.add('hidden');
    document.getElementById(tabId).classList.remove('hidden');
    if (tabId === 'historyTab') renderHistory();
  }

  function loadSavedExercises() {
    for (let name of exercises) {
      const option = document.createElement('option');
      option.value = name;
      option.text = name;
      document.getElementById('exerciseSelect').appendChild(option);
    }
  }

  function loadSavedLog() {
    for (let entry of workoutLog) {
      renderLogItem(entry);
    }
  }

  window.onload = () => {
    loadSavedExercises();
    loadSavedLog();
  };
</script>

</body>
</html>