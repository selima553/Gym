<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gym Tracker</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      background: #f0f2f5;
      padding: 10px;
    }

    h1 {
      text-align: center;
      margin-top: 10px;
    }

    nav {
      display: flex;
      justify-content: space-around;
      background: #fff;
      padding: 10px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    nav button {
      flex: 1;
      padding: 10px;
      border: none;
      background: #e0e0e0;
      font-weight: bold;
    }

    nav button.active {
      background: #007bff;
      color: white;
    }

    section {
      display: none;
    }

    section.active {
      display: block;
    }

    input, select, button {
      padding: 10px;
      margin: 8px 0;
      font-size: 16px;
      width: 100%;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .user-buttons {
      display: flex;
      gap: 10px;
    }

    .user-buttons button {
      flex: 1;
      background: #007bff;
      color: white;
      border: none;
    }

    .log-group {
      background: white;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .log-group h4 {
      margin-top: 0;
      border-bottom: 1px solid #ccc;
      padding-bottom: 4px;
    }

    .log-entry {
      margin-left: 10px;
      padding: 4px 0;
    }

    .edit-btn {
      float: right;
      background: transparent;
      border: none;
      color: #007bff;
      cursor: pointer;
    }

    #filters {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<h1>üèãÔ∏è Gym Tracker</h1>

<nav>
  <button onclick="switchTab('home')" id="btn-home" class="active">Home</button>
  <button onclick="switchTab('history')" id="btn-history">History</button>
</nav>

<section id="home" class="active">
  <select id="exerciseSelect" onchange="handleExerciseChange(this.value)">
    <option value="">-- Select Exercise --</option>
  </select>
  <input type="text" id="newExercise" placeholder="Add new exercise" />
  <button onclick="addExercise()">Add Exercise</button>

  <div class="user-buttons">
    <button onclick="startSet('Selim')">Selim</button>
    <button onclick="startSet('Friend')">Friend</button>
  </div>

  <div id="setDetails" style="display:none;">
    <p id="setInfo"></p>
    <input type="number" id="weight" placeholder="Weight (kg)" />
    <input type="number" id="reps" placeholder="Reps" />
    <input type="number" id="rpe" placeholder="RPE (1-10)" />
    <button onclick="submitSet()">Submit Set</button>
  </div>

  <h3>Today's Log</h3>
  <div id="logList"></div>
</section>

<section id="history">
  <div id="filters">
    <select id="filterExercise" onchange="renderHistory()">
      <option value="">-- All Exercises --</option>
    </select>
    <select id="filterDate" onchange="renderHistory()">
      <option value="">-- All Dates --</option>
    </select>
  </div>
  <div id="historyList"></div>
</section>

<script>
  const today = new Date().toISOString().split("T")[0];
  let workoutLog = JSON.parse(localStorage.getItem("workoutLog")) || [];
  let exercises = JSON.parse(localStorage.getItem("exercises")) || [];
  let setCounts = JSON.parse(localStorage.getItem("setCounts")) || {};
  let currentExercise = '';
  let currentUser = '';

  function switchTab(tabId) {
    document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    document.getElementById('btn-' + tabId).classList.add('active');

    if (tabId === 'history') renderHistory();
  }

  function addExercise() {
    const name = document.getElementById('newExercise').value.trim();
    if (name && !exercises.includes(name)) {
      exercises.push(name);
      localStorage.setItem("exercises", JSON.stringify(exercises));
      updateExerciseDropdowns();
      document.getElementById('exerciseSelect').value = name;
      handleExerciseChange(name);
      document.getElementById('newExercise').value = '';
    }
  }

  function updateExerciseDropdowns() {
    const selects = [document.getElementById('exerciseSelect'), document.getElementById('filterExercise')];
    selects.forEach(select => {
      select.innerHTML = '<option value="">-- Select Exercise --</option>';
      exercises.forEach(name => {
        const option = document.createElement("option");
        option.value = name;
        option.text = name;
        select.appendChild(option);
      });
    });
  }

  function handleExerciseChange(name) {
    currentExercise = name;
  }

  function startSet(user) {
    if (!currentExercise) {
      alert("Please select an exercise first.");
      return;
    }
    currentUser = user;
    const key = `${user}_${currentExercise}`;
    if (!setCounts[key]) setCounts[key] = 1;
    document.getElementById("setInfo").textContent = `User: ${user}, Set: ${setCounts[key]} (${currentExercise})`;
    document.getElementById("setDetails").style.display = "block";
  }

  function submitSet() {
    const weight = document.getElementById("weight").value;
    const reps = document.getElementById("reps").value;
    const rpe = document.getElementById("rpe").value;
    const key = `${currentUser}_${currentExercise}`;
    const setNum = setCounts[key] || 1;

    const entry = {
      user: currentUser,
      exercise: currentExercise,
      set: setNum,
      weight,
      reps,
      rpe,
      date: today
    };

    workoutLog.push(entry);
    setCounts[key] = setNum + 1;

    localStorage.setItem("workoutLog", JSON.stringify(workoutLog));
    localStorage.setItem("setCounts", JSON.stringify(setCounts));

    document.getElementById("setDetails").style.display = "none";
    document.getElementById("weight").value = '';
    document.getElementById("reps").value = '';
    document.getElementById("rpe").value = '';

    renderTodayLog();
  }

  function renderTodayLog() {
    const logContainer = document.getElementById("logList");
    logContainer.innerHTML = '';
    const grouped = {};

    for (let entry of workoutLog) {
      if (entry.date !== today) continue;
      if (!grouped[entry.user]) grouped[entry.user] = {};
      if (!grouped[entry.user][entry.exercise]) grouped[entry.user][entry.exercise] = [];
      grouped[entry.user][entry.exercise].push(entry);
    }

    for (let user in grouped) {
      const userGroup = document.createElement('div');
      userGroup.className = 'log-group';
      userGroup.innerHTML = `<h4>${user}</h4>`;
      for (let ex in grouped[user]) {
        userGroup.innerHTML += `<strong>${ex}</strong>`;
        grouped[user][ex].forEach(set => {
          userGroup.innerHTML += `<div class="log-entry">Set ${set.set}: ${set.weight}kg x ${set.reps} (RPE ${set.rpe})</div>`;
        });
      }
      logContainer.appendChild(userGroup);
    }
  }

  function renderHistory() {
    const filterEx = document.getElementById("filterExercise").value;
    const filterDate = document.getElementById("filterDate").value;
    const list = document.getElementById("historyList");
    list.innerHTML = '';

    const grouped = {};

    for (let entry of workoutLog) {
      if (filterEx && entry.exercise !== filterEx) continue;
      if (filterDate && entry.date !== filterDate) continue;

      if (!grouped[entry.date]) grouped[entry.date] = {};
      if (!grouped[entry.date][entry.user]) grouped[entry.date][entry.user] = {};
      if (!grouped[entry.date][entry.user][entry.exercise]) grouped[entry.date][entry.user][entry.exercise] = [];
      grouped[entry.date][entry.user][entry.exercise].push(entry);
    }

    for (let date in grouped) {
      const dateGroup = document.createElement("div");
      dateGroup.className = 'log-group';
      dateGroup.innerHTML = `<h4>${date}</h4>`;
      for (let user in grouped[date]) {
        dateGroup.innerHTML += `<strong>${user}</strong><br>`;
        for (let ex in grouped[date][user]) {
          dateGroup.innerHTML += `<em>${ex}</em><br>`;
          grouped[date][user][ex].forEach(set => {
            dateGroup.innerHTML += `<div class="log-entry">Set ${set.set}: ${set.weight}kg x ${set.reps} (RPE ${set.rpe})</div>`;
          });
        }
      }
      list.appendChild(dateGroup);
    }
  }

  function populateFilterDates() {
    const dates = new Set(workoutLog.map(entry => entry.date));
    const dateSelect = document.getElementById("filterDate");
    dateSelect.innerHTML = '<option value="">-- All Dates --</option>';
    [...dates].sort((a,b) => b.localeCompare(a)).forEach(date => {
      const opt = document.createElement("option");
      opt.value = date;
      opt.text = date;
      dateSelect.appendChild(opt);
    });
  }

  window.onload = () => {
    updateExerciseDropdowns();
    populateFilterDates();
    renderTodayLog();
  };
</script>

</body>
</html>
